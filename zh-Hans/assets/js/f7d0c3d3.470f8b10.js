"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[465],{3905:(e,t,n)=>{n.d(t,{Zo:()=>s,kt:()=>d});var a=n(7294);function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){l(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,a,l=function(e,t){if(null==e)return{};var n,a,l={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(l[n]=e[n]);return l}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(l[n]=e[n])}return l}var k=a.createContext({}),u=function(e){var t=a.useContext(k),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},s=function(e){var t=u(e.components);return a.createElement(k.Provider,{value:t},e.children)},p="mdxType",c={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,l=e.mdxType,r=e.originalType,k=e.parentName,s=i(e,["components","mdxType","originalType","parentName"]),p=u(n),m=l,d=p["".concat(k,".").concat(m)]||p[m]||c[m]||r;return n?a.createElement(d,o(o({ref:t},s),{},{components:n})):a.createElement(d,o({ref:t},s))}));function d(e,t){var n=arguments,l=t&&t.mdxType;if("string"==typeof e||l){var r=n.length,o=new Array(r);o[0]=m;var i={};for(var k in t)hasOwnProperty.call(t,k)&&(i[k]=t[k]);i.originalType=e,i[p]="string"==typeof e?e:l,o[1]=i;for(var u=2;u<r;u++)o[u]=n[u];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},8702:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>k,contentTitle:()=>o,default:()=>c,frontMatter:()=>r,metadata:()=>i,toc:()=>u});var a=n(7462),l=(n(7294),n(3905));const r={},o="LakeSoul Flink Connector",i={unversionedId:"Usage Docs/flink-lakesoul-connector",id:"Usage Docs/flink-lakesoul-connector",title:"LakeSoul Flink Connector",description:"\u8be5\u529f\u80fd\u4e8e 2.3.0 \u7248\u672c\u8d77\u63d0\u4f9b",source:"@site/i18n/zh-Hans/docusaurus-plugin-content-docs/current/03-Usage Docs/06-flink-lakesoul-connector.md",sourceDirName:"03-Usage Docs",slug:"/Usage Docs/flink-lakesoul-connector",permalink:"/zh-Hans/docs/Usage Docs/flink-lakesoul-connector",draft:!1,editUrl:"https://github.com/lakesoul-io/LakeSoul/tree/main/website/docs/03-Usage Docs/06-flink-lakesoul-connector.md",tags:[],version:"current",sidebarPosition:6,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"LakeSoul Flink CDC \u6574\u5e93\u5343\u8868\u540c\u6b65",permalink:"/zh-Hans/docs/Usage Docs/flink-cdc-sync"},next:{title:"LakeSoul \u5168\u5c40\u81ea\u52a8\u538b\u7f29\u670d\u52a1\u4f7f\u7528\u65b9\u6cd5",permalink:"/zh-Hans/docs/Usage Docs/auto-compaction-task"}},k={},u=[{value:"1. \u73af\u5883\u51c6\u5907",id:"1-\u73af\u5883\u51c6\u5907",level:2},{value:"2. DDL",id:"2-ddl",level:2},{value:"2.1 \u521b\u5efacatalog",id:"21-\u521b\u5efacatalog",level:3},{value:"2.2 \u5efa\u8868",id:"22-\u5efa\u8868",level:3},{value:"2.3 \u4fee\u6539/\u5220\u9664\u8868",id:"23-\u4fee\u6539\u5220\u9664\u8868",level:3},{value:"3. \u5199\u5165\u6570\u636e",id:"3-\u5199\u5165\u6570\u636e",level:2},{value:"3.1 \u5fc5\u987b\u7684\u8bbe\u7f6e\u9879",id:"31-\u5fc5\u987b\u7684\u8bbe\u7f6e\u9879",level:3},{value:"3.2 \u5199\u5165\u6570\u636e",id:"32-\u5199\u5165\u6570\u636e",level:3},{value:"4. \u67e5\u8be2\u6570\u636e",id:"4-\u67e5\u8be2\u6570\u636e",level:2},{value:"4.1 \u5168\u91cf\u8bfb",id:"41-\u5168\u91cf\u8bfb",level:3},{value:"4.2 \u5feb\u7167\u6279\u91cf\u8bfb",id:"42-\u5feb\u7167\u6279\u91cf\u8bfb",level:3},{value:"4.3 \u589e\u91cf\u8303\u56f4\u6279\u91cf\u8bfb",id:"43-\u589e\u91cf\u8303\u56f4\u6279\u91cf\u8bfb",level:3},{value:"4.4 \u6d41\u5f0f\u8bfb",id:"44-\u6d41\u5f0f\u8bfb",level:3},{value:"4.5 Lookup Join",id:"45-lookup-join",level:3}],s={toc:u},p="wrapper";function c(e){let{components:t,...n}=e;return(0,l.kt)(p,(0,a.Z)({},s,n,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("h1",{id:"lakesoul-flink-connector"},"LakeSoul Flink Connector"),(0,l.kt)("admonition",{type:"tip"},(0,l.kt)("p",{parentName:"admonition"},"\u8be5\u529f\u80fd\u4e8e 2.3.0 \u7248\u672c\u8d77\u63d0\u4f9b")),(0,l.kt)("p",null,"LakeSoul \u63d0\u4f9b\u4e86 Flink Connector\uff0c\u5b9e\u73b0\u4e86 Flink Dynamic Table \u63a5\u53e3\uff0c\u53ef\u4ee5\u4f7f\u7528 Flink \u7684 DataStream API\uff0c Table API \u6216 SQL \u6765\u6267\u884c\u5bf9 LakeSoul \u6570\u636e\u7684\u8bfb\u5199\uff0c\u8bfb\u548c\u5199\u5747\u652f\u6301\u6d41\u5f0f\u548c\u6279\u5f0f\u4e24\u79cd\u6a21\u5f0f\u3002"),(0,l.kt)("h2",{id:"1-\u73af\u5883\u51c6\u5907"},"1. \u73af\u5883\u51c6\u5907"),(0,l.kt)("p",null,"\u8bbe\u7f6e LakeSoul \u5143\u6570\u636e\uff0c\u8bf7\u53c2\u8003 ",(0,l.kt)("a",{parentName:"p",href:"/zh-Hans/docs/Usage%20Docs/setup-spark"},"\u8bbe\u7f6e Spark/Flink \u5de5\u7a0b/\u4f5c\u4e1a")),(0,l.kt)("p",null,"Flink\u5f15\u5165 LakeSoul \u4f9d\u8d56\u7684\u65b9\u6cd5\uff1a\u5c06 lakesoul-flink \u6587\u4ef6\u5939\u6253\u5305\u7f16\u8bd1\u540e\u5f97\u5230 lakesoul-flink-2.3.0-flink-1.14-SNAPSHOT.jar\u3002"),(0,l.kt)("p",null,"\u4e3a\u4e86\u4f7f\u7528 Flink \u521b\u5efa LakeSoul \u8868\uff0c\u63a8\u8350\u4f7f\u7528 Flink SQL Client\uff0c\u652f\u6301\u76f4\u63a5\u4f7f\u7528 Flink SQL \u547d\u4ee4\u64cd\u4f5c LakeSoul \u8868\uff0c\u672c\u6587\u6863\u4e2d Flink SQL \u662f\u5728 Flink SQL Client \u754c\u9762\u76f4\u63a5\u8f93\u5165\u8bed\u53e5\uff1bTable API \u9700\u8981\u5728 Java \u9879\u76ee\u4e2d\u7f16\u5199\u4f7f\u7528\u3002"),(0,l.kt)("p",null,"\u5207\u6362\u5230 Flink \u6587\u4ef6\u5939\u4e0b\uff0c\u6267\u884c\u547d\u4ee4\u5f00\u542f SQL Client \u5ba2\u6237\u7aef\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"# \u542f\u52a8 Flink SQL Client\nbin/sql-client.sh embedded -j lakesoul-flink-2.3.0-flink-1.14-SNAPSHOT.jar\n")),(0,l.kt)("h2",{id:"2-ddl"},"2. DDL"),(0,l.kt)("h3",{id:"21-\u521b\u5efacatalog"},"2.1 \u521b\u5efacatalog"),(0,l.kt)("p",null,"\u521b\u5efa LakeSoul \u7c7b\u578b\u7684 catalog\uff0c\u6307\u5b9a catalog \u7c7b\u578b\u4e3a LakeSoul\u3002\u6307\u5b9a LakeSoul \u7684 database\uff0c\u9ed8\u8ba4\u4e3a default"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"Flink SQL",(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"create catalog lakesoul with('type'='lakesoul');\nuse catalog lakesoul;\nshow databases;\nuse `default`;\nshow tables;\n"))),(0,l.kt)("li",{parentName:"ol"},"Table API",(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-Java"},'TableEnvironment tEnv = TableEnvironment.create(EnvironmentSettings.inBatchMode());\nCatalog lakesoulCatalog = new LakeSoulCatalog();\ntEnv.registerCatalog("lakeSoul", lakesoulCatalog);\ntEnv.useCatalog("lakeSoul");\ntEnv.useDatabase("default");\n')))),(0,l.kt)("h3",{id:"22-\u5efa\u8868"},"2.2 \u5efa\u8868"),(0,l.kt)("p",null,"LakeSoul\u652f\u6301\u901a\u8fc7Flink\u521b\u5efa\u591a\u79cd\u7c7b\u578b\u7684\u8868\uff0c\u5305\u62ec\u65e0\u4e3b\u952e\u3001\u6709hash\u5206\u533a\u3001\u6709range\u5206\u533a\u4ee5\u53ca\u540c\u65f6\u5305\u62ecrange\u548chash\u5206\u533a\u3002\n\u5efa\u8868\u7684\u53c2\u6570\u542b\u4e49"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"\u53c2\u6570"),(0,l.kt)("th",{parentName:"tr",align:null},"\u542b\u4e49\u8bf4\u660e"),(0,l.kt)("th",{parentName:"tr",align:null},"\u53c2\u6570\u586b\u5199\u683c\u5f0f"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"PARTITIONED BY"),(0,l.kt)("td",{parentName:"tr",align:null},"\u7528\u4e8e\u6307\u5b9a\u8868\u7684range\u5206\u533a\u5b57\u6bb5\uff0c\u5982\u679c\u4e0d\u5b58\u5728 range \u5206\u533a\u5b57\u6bb5\uff0c\u5219\u7701\u7565"),(0,l.kt)("td",{parentName:"tr",align:null},"PARTITIONED BY (",(0,l.kt)("inlineCode",{parentName:"td"},"date"),")")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"connector"),(0,l.kt)("td",{parentName:"tr",align:null},"\u6570\u636e\u6e90\u8fde\u63a5\u5668\uff0c\u7528\u4e8e\u6307\u5b9a\u6570\u636e\u6e90\u7c7b\u578b"),(0,l.kt)("td",{parentName:"tr",align:null},"'connector'='lakesoul'")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"path"),(0,l.kt)("td",{parentName:"tr",align:null},"\u7528\u4e8e\u6307\u5b9a\u8868\u7684\u5b58\u50a8\u8def\u5f84"),(0,l.kt)("td",{parentName:"tr",align:null},"'path'='file:///tmp/lakesoul/flink/sink/test'")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"use_cdc"),(0,l.kt)("td",{parentName:"tr",align:null},"\u8bbe\u7f6e\u8868\u662f\u5426\u4e3a CDC \u683c\u5f0f (\u53c2\u8003 ",(0,l.kt)("a",{parentName:"td",href:"/zh-Hans/docs/Usage%20Docs/cdc-ingestion-table"},"CDC \u8868\u683c\u5f0f")," )"),(0,l.kt)("td",{parentName:"tr",align:null},"'use_cdc'='true'")))),(0,l.kt)("p",null,"LakeSoul \u8868\u652f\u6301 Flink \u7684\u6240\u6709\u5e38\u7528\u6570\u636e\u7c7b\u578b\uff0c\u5e76\u4e0e Spark SQL \u6570\u636e\u7c7b\u578b\u4e00\u4e00\u5bf9\u5e94\uff0c\u4f7f LakeSoul \u8868\u80fd\u540c\u65f6\u652f\u6301 Flink \u548c Spark \u7684\u8bfb\u5199\u3002"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"Flink SQL",(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"-- \u521b\u5efatest_table\u8868\uff0c\u4ee5id\u548cname\u4f5c\u4e3a\u8054\u5408\u4e3b\u952e\uff0c\u4ee5region\u548cdate\u4f5c\u4e3a\u4e24\u7ea7range\u5206\u533a\uff0ccatalog\u662flakesoul\uff0cdatabase\u662fdefault\ncreate table `lakesoul`.`default`.test_table (\n            `id` INT,\n            name STRING,\n            score INT,\n            `date` STRING,\n            region STRING,\n        PRIMARY KEY (`id`,`name`) NOT ENFORCED\n        ) PARTITIONED BY (`region`,`date`)\n        WITH (\n            'connector'='lakesoul',\n            'use_cdc'='true',\n            'path'='file:///tmp/lakesoul/flink/sink/test');          \n"))),(0,l.kt)("li",{parentName:"ol"},"Table API",(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-Java"},'String createUserSql = "create table user_info (" +\n        "    order_id INT," +\n        "    name STRING PRIMARY KEY NOT ENFORCED," +\n        "    score INT" +\n        ") WITH (" +\n        "    \'connector\'=\'lakesoul\'," +\n        "    \'use_cdc\'=\'true\'," +\n        "    \'path\'=\'/tmp/lakesoul/flink/user\' )";\ntEnv.executeSql(createUserSql);\n')))),(0,l.kt)("h3",{id:"23-\u4fee\u6539\u5220\u9664\u8868"},"2.3 \u4fee\u6539/\u5220\u9664\u8868"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"Flink SQL",(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"ALTER TABLE test_table RENAME TO new_table;\nDROP TABLE if exists test_table; \n"))),(0,l.kt)("li",{parentName:"ol"},"Table API",(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-java"},'tEnvs.executeSql("ALTER TABLE test_table RENAME TO new_table")\ntEnvs.executeSql("DROP TABLE if exists test_table");\n')))),(0,l.kt)("h2",{id:"3-\u5199\u5165\u6570\u636e"},"3. \u5199\u5165\u6570\u636e"),(0,l.kt)("p",null,"LakeSoul \u652f\u6301\u5728 Flink \u4e2d\u6279\u5f0f\u6216\u6d41\u5f0f\u5199\u5165\u6570\u636e\u5230 LakeSoul \u8868\u3002\u5bf9\u4e8e\u65e0\u4e3b\u952e\u7684\u8868\uff0c\u5199\u5165\u65f6\u81ea\u52a8\u6267\u884c\u8ffd\u52a0\u6a21\u5f0f\uff08Append\uff09\uff0c\u5bf9\u4e8e\u6709\u4e3b\u952e\u8868\uff0c\u5199\u5165\u65f6\u81ea\u52a8\u6267\u884c Upsert \u6a21\u5f0f\u3002"),(0,l.kt)("h3",{id:"31-\u5fc5\u987b\u7684\u8bbe\u7f6e\u9879"},"3.1 \u5fc5\u987b\u7684\u8bbe\u7f6e\u9879"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"\u5bf9\u6d41\u3001\u6279\u5199\u5165\uff0c\u90fd\u5fc5\u987b\u5f00\u542f ",(0,l.kt)("inlineCode",{parentName:"li"},"execution.checkpointing.checkpoints-after-tasks-finish.enabled")," \u9009\u9879\uff1b"),(0,l.kt)("li",{parentName:"ol"},"\u5bf9\u6d41\u5199\u5165\uff0c\u9700\u8981\u8bbe\u7f6e checkpoint \u95f4\u9694\uff0c\u5efa\u8bae\u4e3a 1 \u5206\u949f\u4ee5\u4e0a\uff1b"),(0,l.kt)("li",{parentName:"ol"},"\u6839\u636e\u73af\u5883\u8bbe\u7f6e\u76f8\u5e94\u7684\u65f6\u533a\uff1a")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"SET 'table.local-time-zone' = 'Asia/Shanghai';\nset 'execution.checkpointing.checkpoints-after-tasks-finish.enabled' = 'true';\n-- \u8bbe\u7f6e checkpointing \u65f6\u95f4\u95f4\u9694\nset 'execution.checkpointing.interval' = '2min';\n")),(0,l.kt)("h3",{id:"32-\u5199\u5165\u6570\u636e"},"3.2 \u5199\u5165\u6570\u636e"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"Flink SQL"),(0,l.kt)("p",{parentName:"li"},"\u6279\u5f0f\uff1a\u76f4\u63a5\u63d2\u5165\u6570\u636e"),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"insert into `lakesoul`.`default`.test_table values (1,'AAA', 98, '2023-05-10', 'China');\n")),(0,l.kt)("p",{parentName:"li"},"\u6d41\u5f0f\uff1a\u6784\u5efa\u6d41\u5f0f\u4efb\u52a1\uff0c\u4ece\u53e6\u4e00\u4e2a\u6d41\u5f0f\u6570\u636e\u6e90\u4e2d\u8bfb\u53d6\u6570\u636e\u5e76\u5199\u5165\u5230 LakeSoul \u8868\u4e2d\u3002\u5982\u679c\u4e0a\u6e38\u6570\u636e\u662f CDC \u7684\u683c\u5f0f\uff0c\u5219\u76ee\u6807\u5199\u5165\u7684 LakeSoul \u8868\u4e5f\u9700\u8981\u8bbe\u7f6e\u4e3a CDC \u8868\u3002"),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"-- \u8868\u793a\u5c06`lakesoul`.`cdcsink`.soure_table\u8868\u4e2d\u7684\u5168\u90e8\u6570\u636e\uff0c\u63d2\u5165\u5230lakesoul`.`default`.test_table\ninsert into `lakesoul`.`default`.test_table select * from `lakesoul`.`cdcsink`.soure_table;\n"))),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"Table API"),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-java"},"tEnvs.executeSql(\"INSERT INTO user_info VALUES (1, 'Bob', 90), (2, 'Alice', 80), (3, 'Jack', 75), (3, 'Amy', 95),(5, 'Tom', 75), (4, 'Mike', 70)\").await();\n")))),(0,l.kt)("h2",{id:"4-\u67e5\u8be2\u6570\u636e"},"4. \u67e5\u8be2\u6570\u636e"),(0,l.kt)("p",null,"\u652f\u6301Flink\u6309\u6279\u5f0f\u548c\u6d41\u5f0f\u8bfb\u53d6lakesoul\u8868\uff0c\u5728Flink SQLClient\u5ba2\u6237\u7aef\u6267\u884c\u547d\u4ee4\uff0c\u5207\u6362\u6d41\u5f0f\u548c\u6279\u5f0f\u7684\u6267\u884c\u6a21\u5f0f\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"-- \u6309\u7167\u6d41\u5f0f\u6267\u884cFlink\u4efb\u52a1\nSET execution.runtime-mode = streaming;\n-- \u6309\u7167\u6279\u5f0f\u6267\u884cFlink\u4efb\u52a1\nSET execution.runtime-mode = batch;\n")),(0,l.kt)("p",null,"\u4f7f\u7528 Flink SQL\uff0c\u6307\u5b9a\u6761\u4ef6\u67e5\u8be2\u7684\u683c\u5f0f\u4e3a ",(0,l.kt)("inlineCode",{parentName:"p"},"SELECT * FROM test_table /*+ OPTIONS('key'='value')*/ WHERE partition=xxx")," \u3002\u5728\u4efb\u4f55\u4e00\u79cd\u8bfb\u7684\u6a21\u5f0f\u4e0b\uff0c\u5206\u533a\u53ef\u4ee5\u6307\u5b9a\uff0c\u4e5f\u53ef\u4ee5\u4e0d\u6307\u5b9a\uff0c\u4e5f\u53ef\u4ee5\u53ea\u6307\u5b9a\u4e00\u90e8\u5206\u5206\u533a\u503c\uff0cLakeSoul \u4f1a\u81ea\u52a8\u5339\u914d\u6ee1\u8db3\u6761\u4ef6\u7684\u5206\u533a\u3002"),(0,l.kt)("p",null,"\u5176\u4e2d ",(0,l.kt)("inlineCode",{parentName:"p"},"/* OPTIONS() */")," \u4e3a\u67e5\u8be2\u9009\u9879\uff08hints\uff09\uff0c\u5fc5\u987b\u8981\u76f4\u63a5\u8ddf\u5728\u8868\u540d\u7684\u540e\u9762\uff08\u5728 where \u7b49\u5176\u4ed6\u5b50\u53e5\u7684\u524d\u9762\uff09\uff0cLakeSoul \u8bfb\u53d6\u65f6\u7684 hint \u9009\u9879\u5305\u62ec\uff1a"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"\u53c2\u6570"),(0,l.kt)("th",{parentName:"tr",align:null},"\u542b\u4e49\u8bf4\u660e"),(0,l.kt)("th",{parentName:"tr",align:null},"\u53c2\u6570\u586b\u5199\u683c\u5f0f"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"readtype"),(0,l.kt)("td",{parentName:"tr",align:null},"\u8bfb\u7c7b\u578b\uff0c\u53ef\u4ee5\u6307\u5b9a\u589e\u91cf\u8bfbincremental\uff0c\u5feb\u7167\u8bfbsnapshot\uff0c\u4e0d\u6307\u5b9a\u9ed8\u8ba4\u5168\u91cf\u8bfb"),(0,l.kt)("td",{parentName:"tr",align:null},"'readtype'='incremental'")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"discoveryinterval"),(0,l.kt)("td",{parentName:"tr",align:null},"\u6d41\u5f0f\u589e\u91cf\u8bfb\u7684\u53d1\u73b0\u65b0\u6570\u636e\u65f6\u95f4\u95f4\u9694\uff0c\u5355\u4f4d\u6beb\u79d2\uff0c\u9ed8\u8ba4\u4e3a 2000"),(0,l.kt)("td",{parentName:"tr",align:null},"'discoveryinterval'='10000'")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"readstarttime"),(0,l.kt)("td",{parentName:"tr",align:null},"\u8d77\u59cb\u8bfb\u65f6\u95f4\u6233\uff0c\u5982\u679c\u672a\u6307\u5b9a\u8d77\u59cb\u65f6\u95f4\u6233\uff0c\u5219\u9ed8\u8ba4\u4ece\u8d77\u59cb\u7248\u672c\u53f7\u5f00\u59cb\u8bfb\u53d6"),(0,l.kt)("td",{parentName:"tr",align:null},"'readstarttime'='2023-05-01 15:15:15'")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"readendtime"),(0,l.kt)("td",{parentName:"tr",align:null},"\u7ed3\u675f\u8bfb\u65f6\u95f4\u6233\uff0c\u5982\u679c\u672a\u6307\u5b9a\u7ed3\u675f\u65f6\u95f4\u6233\uff0c\u5219\u9ed8\u8ba4\u8bfb\u53d6\u5230\u5f53\u524d\u6700\u65b0\u7248\u672c\u53f7"),(0,l.kt)("td",{parentName:"tr",align:null},"'readendtime'='2023-05-01 15:20:15'")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"timezone"),(0,l.kt)("td",{parentName:"tr",align:null},"\u65f6\u95f4\u6233\u7684\u65f6\u533a\u4fe1\u606f\uff0c\u5982\u679c\u4e0d\u6307\u5b9a\u65f6\u95f4\u6233\u7684\u65f6\u533a\u4fe1\u606f\uff0c\u5219\u9ed8\u8ba4\u4e3a\u6309\u672c\u673a\u65f6\u533a\u5904\u7406"),(0,l.kt)("td",{parentName:"tr",align:null},"'timezone'='Asia/Sahanghai'")))),(0,l.kt)("h3",{id:"41-\u5168\u91cf\u8bfb"},"4.1 \u5168\u91cf\u8bfb"),(0,l.kt)("p",null,"\u652f\u6301\u6309\u6279\u5f0f\u548c\u6d41\u5f0f\u8bfb\u53d6 LakeSoul \u8868\u7684\u5168\u91cf\u6570\u636e\u3002\u6279\u5f0f\u662f\u8bfb\u53d6\u6307\u5b9a\u8868\u6307\u5b9a\u5206\u533a\u5728\u5f53\u524d\u65f6\u95f4\u4e0b\u7684\u6700\u65b0\u7248\u672c\u7684\u5168\u91cf\u6570\u636e\u3002\u6d41\u5f0f\u8bfb\u53d6\u5219\u662f\u5148\u8bfb\u53d6\u5f53\u524d\u65f6\u95f4\u4e0b\u7684\u6700\u65b0\u7248\u672c\u5168\u91cf\u6570\u636e\uff0c\u5e76\u4e14\u4e00\u65e6\u53d1\u751f\u6570\u636e\u66f4\u65b0\uff0c\u53ef\u4ee5\u81ea\u52a8\u8bc6\u522b\u5e76\u8fde\u7eed\u4e0d\u95f4\u65ad\u8bfb\u53d6\u589e\u91cf\u6570\u636e\u3002"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"Flink SQL"),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"-- \u8bbe\u7f6e\u6279\u5f0f\u6a21\u5f0f\uff0c\u8bfb\u53d6test_table\u8868\nSET execution.runtime-mode = batch;\nSELECT * FROM `lakesoul`.`default`.test_table where region='China' and `date`='2023-05-10' order by id;\n\n-- \u8bbe\u7f6e\u6d41\u5f0f\u6a21\u5f0f\uff0c\u8bfb\u53d6test_table\u8868\nSET execution.runtime-mode = stream;\nset 'execution.checkpointing.checkpoints-after-tasks-finish.enabled' = 'true';\n-- \u8bbe\u7f6e checkpointing \u65f6\u95f4\u95f4\u9694\nset 'execution.checkpointing.interval' = '1min';\nSELECT * FROM `lakesoul`.`default`.test_table where id > 3;\n"))),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"Table API\u683c\u5f0f"),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-java"},'// \u521b\u5efa\u6279\u5f0f\u6267\u884c\u73af\u5883\nStreamExecutionEnvironment env = StreamExecutionEnvironment.createLocalEnvironmentWithWebUI(new Configuration());\nenv.setRuntimeMode(RuntimeExecutionMode.BATCH);\nStreamTableEnvironment tEnvs = StreamTableEnvironment.create(env);\n//\u8bbe\u7f6elakesoul \u7c7b\u578b\u7684catalog\nCatalog lakesoulCatalog = new LakeSoulCatalog();\ntEnvs.registerCatalog("lakeSoul", lakesoulCatalog);\ntEnvs.useCatalog("lakeSoul");\ntEnvs.useDatabase("default");\n\ntEnvs.executeSql("SELECT * FROM test_table order by id").print();\n')),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-java"},'// \u521b\u5efa\u6d41\u5f0f\u6267\u884c\u73af\u5883\nStreamExecutionEnvironment env = StreamExecutionEnvironment.createLocalEnvironmentWithWebUI(new Configuration());\nenv.setRuntimeMode(RuntimeExecutionMode.STREAMING);\nenv.enableCheckpointing(2000, CheckpointingMode.EXACTLY_ONCE);\nenv.getCheckpointConfig().setExternalizedCheckpointCleanup(CheckpointConfig.ExternalizedCheckpointCleanup.RETAIN_ON_CANCELLATION);\nStreamTableEnvironment tEnvs = StreamTableEnvironment.create(env);\n//\u8bbe\u7f6elakesoul \u7c7b\u578b\u7684catalog\nCatalog lakesoulCatalog = new LakeSoulCatalog();\ntEnvs.registerCatalog("lakeSoul", lakesoulCatalog);\ntEnvs.useCatalog("lakeSoul");\ntEnvs.useDatabase("default");\n\ntEnvs.executeSql("SELECT * FROM test_table where id > 3").print();\n')))),(0,l.kt)("h3",{id:"42-\u5feb\u7167\u6279\u91cf\u8bfb"},"4.2 \u5feb\u7167\u6279\u91cf\u8bfb"),(0,l.kt)("p",null,"LakeSoul \u652f\u6301\u5bf9\u8868\u6267\u884c\u5feb\u7167\u8bfb\u53d6\uff0c\u7528\u6237\u901a\u8fc7\u6307\u5b9a\u5206\u533a\u4fe1\u606f\u548c\u7ed3\u675f\u65f6\u95f4\u6233\uff0c\u53ef\u4ee5\u67e5\u8be2\u7ed3\u675f\u65f6\u95f4\u6233\u4e4b\u524d\u7684\u6240\u6709\u6570\u636e\u3002"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"Flink SQL",(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"-- \u5bf9test_table\u5728region=China\u5206\u533a\u6267\u884c\u5feb\u7167\u8bfb\uff0c\u8bfb\u53d6\u7684\u7ed3\u675f\u65f6\u95f4\u6233\u662f2023-05-01 15:20:15\uff0c\u65f6\u533a\u6309Asia/Shanghai\nSELECT * FROM `lakesoul`.`default`.test_table /*+ OPTIONS('readtype'='snapshot', 'readendtime'='2023-05-01 15:20:15', 'timezone'='Asia/Shanghai')*/ where region='China';\n"))),(0,l.kt)("li",{parentName:"ol"},"Table API",(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-java"},"tEnvs.executeSql(\"SELECT * FROM `lakesoul`.`default`.test_table /*+ OPTIONS('readtype'='snapshot', 'readendtime'='2023-05-01 15:20:15', 'timezone'='Asia/Shanghai')*/\").print();\n")))),(0,l.kt)("h3",{id:"43-\u589e\u91cf\u8303\u56f4\u6279\u91cf\u8bfb"},"4.3 \u589e\u91cf\u8303\u56f4\u6279\u91cf\u8bfb"),(0,l.kt)("p",null,"LakeSoul \u652f\u6301\u5bf9\u8868\u6267\u884c\u8303\u56f4\u589e\u91cf\u8bfb\u53d6\uff0c\u7528\u6237\u901a\u8fc7\u6307\u5b9a\u5206\u533a\u4fe1\u606f\u548c\u8d77\u59cb\u65f6\u95f4\u6233\u3001\u7ed3\u675f\u65f6\u95f4\u6233\uff0c\u53ef\u4ee5\u67e5\u8be2\u8fd9\u4e00\u65f6\u95f4\u8303\u56f4\u5185\u7684\u589e\u91cf\u6570\u636e\u3002"),(0,l.kt)("p",null,"Flink SQL\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"-- \u5bf9test_table\u5728region=China\u5206\u533a\u6267\u884c\u589e\u91cf\u8bfb\uff0c\u8bfb\u53d6\u7684\u65f6\u95f4\u6233\u8303\u56f42023-05-01 15:15:15\u52302023-05-01 15:20:15\uff0c\u65f6\u533a\u6309Asia/Shanghai\nSELECT * FROM `lakesoul`.`default`.test_table /*+ OPTIONS('readtype'='incremental', 'readstarttime'='2023-05-01 15:15:15', 'readendtime'='2023-05-01 15:20:15', 'timezone'='Asia/Shanghai')*/ where region='China';\n")),(0,l.kt)("h3",{id:"44-\u6d41\u5f0f\u8bfb"},"4.4 \u6d41\u5f0f\u8bfb"),(0,l.kt)("p",null,"LakeSoul \u8868\u652f\u6301\u5728 Flink \u6267\u884c\u6d41\u5f0f\u8bfb\u53d6\uff0c\u6d41\u5f0f\u8bfb\u57fa\u4e8e\u589e\u91cf\u8bfb\uff0c\u7528\u6237\u901a\u8fc7\u6307\u5b9a\u8d77\u59cb\u65f6\u95f4\u6233\u548c\u5206\u533a\u4fe1\u606f\uff0c\u53ef\u4ee5\u8fde\u7eed\u4e0d\u95f4\u65ad\u8bfb\u53d6\u81ea\u8d77\u59cb\u65f6\u95f4\u6233\u4ee5\u540e\u7684\u65b0\u589e\u6570\u636e\u3002"),(0,l.kt)("p",null,"Flink SQL\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"-- \u6309\u7167\u6d41\u5f0f\u8bfb\u53d6test_table\u5728region=China\u5206\u533a\u7684\u6570\u636e\uff0c\u8bfb\u53d6\u7684\u8d77\u59cb\u65f6\u95f4\u6233\u662f2023-05-01 15:15:15\uff0c\u65f6\u533a\u6309Asia/Shanghai\nSET execution.runtime-mode = streaming;\nset 'execution.checkpointing.checkpoints-after-tasks-finish.enabled' = 'true';\n-- \u8bbe\u7f6e checkpointing \u65f6\u95f4\u95f4\u9694\nset 'execution.checkpointing.interval' = '1min';\nSELECT * FROM test_table /*+ OPTIONS('readstarttime'='2023-05-01 15:15:15','timezone'='Asia/Shanghai')*/ where region='China';\n")),(0,l.kt)("p",null,"\u5728\u6d41\u5f0f\u8bfb\u53d6\u65f6\uff0cLakeSoul \u5b8c\u6574\u652f\u6301 Flink Changelog Stream \u8bed\u4e49\u3002\u5bf9\u4e8e LakeSoul CDC \u8868\uff0c\u589e\u91cf\u8bfb\u53d6\u7684\u7ed3\u679c\u4ecd\u7136\u4e3a CDC \u683c\u5f0f\uff0c\u5373\u5305\u542b\u4e86 ",(0,l.kt)("inlineCode",{parentName:"p"},"insert"),"\uff0c",(0,l.kt)("inlineCode",{parentName:"p"},"update"),"\uff0c",(0,l.kt)("inlineCode",{parentName:"p"},"delete")," \u4e8b\u4ef6\uff0c\u8fd9\u4e9b\u4e8b\u4ef6\u4f1a\u81ea\u52a8\u8f6c\u4e3a Flink RowData \u7684 RowKind \u5b57\u6bb5\u7684\u5bf9\u5e94\u503c\uff0c\u4ece\u800c\u5728 Flink \u4e2d\u5b9e\u73b0\u4e86\u5168\u94fe\u8def\u7684\u589e\u91cf\u8ba1\u7b97\u3002"),(0,l.kt)("h3",{id:"45-lookup-join"},"4.5 Lookup Join"),(0,l.kt)("p",null,"LakeSoul \u8868\u652f\u6301 Flink SQL \u4e2d\u7684 Lookup Join \u64cd\u4f5c\u3002Lookup Join \u4f1a\u5c06\u5f85 Join \u7684\u53f3\u8868\u7f13\u5b58\u5728\u5185\u5b58\u4e2d\uff0c\u4ece\u800c\u5927\u5e45\u63d0\u5347 Join \u901f\u5ea6\uff0c\u53ef\u4ee5\u5728\u8f83\u5c0f\u7ef4\u8868\u5173\u8054\u7684\u573a\u666f\u4e2d\u4f7f\u7528\u4ee5\u63d0\u5347\u6027\u80fd\u3002LakeSoul \u9ed8\u8ba4\u6bcf\u9694 60 \u79d2\u4f1a\u5c1d\u8bd5\u5237\u65b0\u7f13\u5b58\uff0c\u8fd9\u4e2a\u95f4\u9694\u53ef\u4ee5\u901a\u8fc7\u5728\u521b\u5efa\u7ef4\u8868\u65f6\u8bbe\u7f6e ",(0,l.kt)("inlineCode",{parentName:"p"},"'lookup.join.cache.ttl'='60s'")," \u8868\u5c5e\u6027\u6765\u4fee\u6539\u3002"),(0,l.kt)("p",null,"Flink SQL \u4e2d\u7684 Lookup join \u8981\u6c42\u4e00\u4e2a\u8868\u5177\u6709\u5904\u7406\u65f6\u95f4\u5c5e\u6027\uff0c\u53e6\u4e00\u4e2a\u8868\u7531\u67e5\u627e\u6e90\u8fde\u63a5\u5668\uff08lookup source connnector\uff09\u652f\u6301\u3002LakeSoul \u8868\u652f\u6301\u4e86Flink\u7684\u6e90\u8fde\u63a5\u5668\u3002"),(0,l.kt)("p",null,"\u4e0b\u9762\u7684\u4f8b\u5b50\u5c55\u793a\u4e86\u57fa\u4e8e LakeSoul \u8868\u7684 lookup join \u7684\u8bed\u6cd5\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"CREATE TABLE `lakesoul`.`default`.customers (\n            `c_id` INT,\n            `name` STRING,\n        PRIMARY KEY (`c_id`) NOT ENFORCED)\n        WITH (\n            'connector'='lakesoul',\n            'path'='file:///tmp/lakesoul/flink/sink/customers'\n            );  \nCREATE TABLE `lakesoul`.`default`.orders (\n            `o_id` INT,\n            `o_c_id` INT,\n        PRIMARY KEY (`o_id`) NOT ENFORCED)\n        WITH (\n            'connector'='lakesoul',\n            'path'='file:///tmp/lakesoul/flink/sink/orders',\n            'lookup.join.cache.ttl'='60s'\n            );  \nSELECT `o_id`, `c_id`, `name`\nFROM\n(SELECT *, proctime() as proctime FROM `lakesoul`.`default`.orders) as o\nJOIN `lakesoul`.`default`.customers FOR SYSTEM_TIME AS OF o.proctime\nON c_id = o_cid;\n")),(0,l.kt)("p",null,"\u5728\u4e0a\u9762\u7684\u793a\u4f8b\u4e2d\uff0cOrders \u8868\u9700\u8981\u4e0e Customers \u8868\u7684\u6570\u636e\u8fdb\u884c Lookup Join\u3002\u5e26\u6709\u540e\u7eed process time \u5c5e\u6027\u7684 FOR SYSTEM_TIME AS OF \u5b50\u53e5\u786e\u4fdd\u5728\u8054\u63a5\u8fd0\u7b97\u7b26\u5904\u7406 Orders \u884c\u65f6\uff0cOrders \u7684\u6bcf\u4e00\u884c\u90fd\u4e0e join \u6761\u4ef6\u5339\u914d\u7684 Customer \u884c\u8fde\u63a5\u3002\u5b83\u8fd8\u9632\u6b62\u8fde\u63a5\u7684 Customer \u8868\u5728\u672a\u6765\u53d1\u751f\u66f4\u65b0\u65f6\u53d8\u66f4\u8fde\u63a5\u7ed3\u679c\u3002lookup join \u8fd8\u9700\u8981\u4e00\u4e2a\u5f3a\u5236\u7684\u76f8\u7b49\u8fde\u63a5\u6761\u4ef6\uff0c\u5728\u4e0a\u9762\u7684\u793a\u4f8b\u4e2d\u662f o_c_id = c_id"))}c.isMDXComponent=!0}}]);