"use strict";(self.webpackChunklakesoul_website=self.webpackChunklakesoul_website||[]).push([[3552],{2851:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>l,default:()=>d,frontMatter:()=>r,metadata:()=>a,toc:()=>c});var t=s(5893),i=s(1151);const r={},l="\u90e8\u7f72 PostgreSQL \u9ad8\u53ef\u7528\u96c6\u7fa4",a={id:"Deployment/Postgres-Cluster",title:"\u90e8\u7f72 PostgreSQL \u9ad8\u53ef\u7528\u96c6\u7fa4",description:"\x3c!--",source:"@site/i18n/zh-Hans/docusaurus-plugin-content-docs/current/04-Deployment/01-Postgres-Cluster.md",sourceDirName:"04-Deployment",slug:"/Deployment/Postgres-Cluster",permalink:"/zh-Hans/docs/Deployment/Postgres-Cluster",draft:!1,unlisted:!1,editUrl:"https://github.com/lakesoul-io/LakeSoul/tree/main/website/docs/04-Deployment/01-Postgres-Cluster.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"\u5728 Spark Gluten \u4e2d\u8bfb\u5199 LakeSoul",permalink:"/zh-Hans/docs/Usage Docs/spark-gluten/"}},o={},c=[{value:"\u4f7f\u7528Pigsty\u5b89\u88c5\u90e8\u7f72",id:"\u4f7f\u7528pigsty\u5b89\u88c5\u90e8\u7f72",level:2},{value:"\u4e0b\u8f7dPigsty\u5b89\u88c5\u5305",id:"\u4e0b\u8f7dpigsty\u5b89\u88c5\u5305",level:3},{value:"\u5b89\u88c5\u90e8\u7f72",id:"\u5b89\u88c5\u90e8\u7f72",level:3},{value:"\u9a8c\u8bc1",id:"\u9a8c\u8bc1",level:3},{value:"\u76d1\u63a7",id:"\u76d1\u63a7",level:3}];function p(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",p:"p",pre:"pre",...(0,i.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h1,{id:"\u90e8\u7f72-postgresql-\u9ad8\u53ef\u7528\u96c6\u7fa4",children:"\u90e8\u7f72 PostgreSQL \u9ad8\u53ef\u7528\u96c6\u7fa4"}),"\n",(0,t.jsx)(n.h2,{id:"\u4f7f\u7528pigsty\u5b89\u88c5\u90e8\u7f72",children:"\u4f7f\u7528Pigsty\u5b89\u88c5\u90e8\u7f72"}),"\n",(0,t.jsx)(n.p,{children:"\u6211\u4eec\u63a8\u8350\u4f7f\u7528\u81ea\u52a8\u5316\u5de5\u5177\u90e8\u7f72 PostgreSQL \u9ad8\u53ef\u7528\u96c6\u7fa4\uff0c\u4f8b\u5982 Pigsty\u3002"}),"\n",(0,t.jsxs)(n.p,{children:["Pigsty \u5b98\u65b9\u4ecb\u7ecd\uff1a ",(0,t.jsx)(n.a,{href:"https://doc.pigsty.cc/#/zh/README",children:"https://doc.pigsty.cc/#/zh/README"})]}),"\n",(0,t.jsx)(n.h3,{id:"\u4e0b\u8f7dpigsty\u5b89\u88c5\u5305",children:"\u4e0b\u8f7dPigsty\u5b89\u88c5\u5305"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ini",children:"curl -L https://get.pigsty.cc/v2.5.1/pigsty-v2.5.1.tgz -o ~/pigsty.tgz \ncurl -L https://get.pigsty.cc/v2.5.1/pigsty-pkg-v2.5.1.el7.x86_64.tgz -o /tmp/pkg.tgz\n"})}),"\n",(0,t.jsx)(n.h3,{id:"\u5b89\u88c5\u90e8\u7f72",children:"\u5b89\u88c5\u90e8\u7f72"}),"\n",(0,t.jsx)(n.p,{children:"1\u3001\u5404\u8282\u70b9ssh\u514d\u5bc6\u767b\u9646"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ini",children:"ssh-keygen -t rsa\nssh-copy-id root@hosts\n"})}),"\n",(0,t.jsx)(n.admonition,{type:"tip",children:(0,t.jsx)(n.p,{children:"hosts \u4e3a\u5305\u542b\u81ea\u5df1\u5728\u5185\u7684\u6240\u6709\u8282\u70b9\uff0c\u90fd\u8981\u514d\u5bc6"})}),"\n",(0,t.jsx)(n.p,{children:"2\u3001\u5404\u8282\u70b9\u521d\u59cb\u5316"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ini",children:'bash -c "$(curl -fsSL https://get.pigsty.cc/latest)"  \ncd ~/pigsty\n./bootstrap \n'})}),"\n",(0,t.jsx)(n.p,{children:"3\u3001\u4e3b\u8282\u70b9\u914d\u7f6e\u96c6\u7fa4\u4fe1\u606f\uff0c\u4fee\u6539~/pigsty/pigsty.yml\uff0c\u53c2\u8003\u5982\u4e0b\uff1a"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"all:\n  children:\n    # infra cluster for proxy, monitor, alert, etc..\n    infra: { hosts: { 192.168.17.91: { infra_seq: 1 } } }\n    # etcd cluster for ha postgres\n    etcd: { hosts: { 192.168.17.91: { etcd_seq: 1 } }, vars: { etcd_cluster: etcd } }\n    # minio cluster, optional backup repo for pgbackrest\n    #minio: { hosts: { 192.168.17.91: { minio_seq: 1 } }, vars: { minio_cluster: minio } }\n    # postgres cluster 'pg-meta' with single primary instance\n    pg-test:\n      hosts:\n        192.168.17.91: { pg_seq: 1, pg_role: primary }   # primary instance, leader of cluster\n        192.168.25.215: { pg_seq: 2, pg_role: replica }   # replica instance, follower of leader\n        192.168.28.137: { pg_seq: 3, pg_role: replica, pg_offline_query: true } # replica with offline access\n      vars:\n        pg_cluster: pg-test           # define pgsql cluster name\n        pg_users:  [{ name: test , password: test , pgbouncer: true , roles: [ dbrole_admin ] }]\n        pg_databases: [{ name: test }]\n        pg_vip_enabled: true\n        pg_vip_address: 192.168.17.92/24\n        pg_vip_interface: eth0\n        node_tune: tiny\n        pg_conf: tiny.yml\n        node_crontab:  # make a full backup on monday 1am, and an incremental backup during weekdays\n          - '00 01 * * 1 postgres /pg/bin/pg-backup full'\n          - '00 01 * * 2,3,4,5,6,7 postgres /pg/bin/pg-backup'\n  vars:                               # global parameters\n    version: v2.5.1                   # pigsty version string\n    admin_ip: 192.168.17.91             # admin node ip address\n    region: china                     # upstream mirror region: default,china,europe\n"})}),"\n",(0,t.jsx)(n.admonition,{type:"tip",children:(0,t.jsx)(n.p,{children:"pg_vip_address\u9700\u8981\u914d\u7f6e"})}),"\n",(0,t.jsx)(n.p,{children:"4\u3001\u4e3b\u8282\u70b9\u6267\u884c\u5b89\u88c5\u811a\u672c"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ini",children:"./install.yml \n"})}),"\n",(0,t.jsx)(n.h3,{id:"\u9a8c\u8bc1",children:"\u9a8c\u8bc1"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ini",children:"patronictl -c /etc/patroni/patroni.yml list\n"})}),"\n",(0,t.jsxs)(n.admonition,{type:"tip",children:[(0,t.jsx)(n.p,{children:"\u624b\u5de5\u5207\u6362\uff1apatronictl -c /etc/patroni/patroni.yml switchover"}),(0,t.jsx)(n.p,{children:"\u6570\u636e\u5907\u4efd\uff1a/pg/bin/pg-backup full;\u5728/etc/crontab\u4e2d\u5b58\u5728\u5168\u91cf\u548c\u589e\u91cf\u5907\u4efd\u5b9a\u65f6\u4efb\u52a1"})]}),"\n",(0,t.jsx)(n.h3,{id:"\u76d1\u63a7",children:"\u76d1\u63a7"}),"\n",(0,t.jsx)(n.p,{children:"Grafana"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ini",children:"http://192.168.17.91:3000\n"})}),"\n",(0,t.jsx)(n.admonition,{type:"tip",children:(0,t.jsx)(n.p,{children:"\u4f7f\u7528\u6b63\u786e\u7684ip\u5730\u5740"})})]})}function d(e={}){const{wrapper:n}={...(0,i.a)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(p,{...e})}):p(e)}},1151:(e,n,s)=>{s.d(n,{Z:()=>a,a:()=>l});var t=s(7294);const i={},r=t.createContext(i);function l(e){const n=t.useContext(r);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:l(e.components),t.createElement(r.Provider,{value:n},e.children)}}}]);