<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-Usage Docs/flink-cdc-sync">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.0">
<title data-rh="true">LakeSoul Flink CDC Synchronization of Entire MySQL Database | LakeSoul - An Opensource Cloud Native Realtime Lakehouse Framework</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://lakesoul-io.github.io/img/LakeSoul_Horizontal_White.png"><meta data-rh="true" name="twitter:image" content="https://lakesoul-io.github.io/img/LakeSoul_Horizontal_White.png"><meta data-rh="true" property="og:url" content="https://lakesoul-io.github.io/docs/Usage Docs/flink-cdc-sync"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="LakeSoul Flink CDC Synchronization of Entire MySQL Database | LakeSoul - An Opensource Cloud Native Realtime Lakehouse Framework"><meta data-rh="true" name="description" content="Since version 2.1.0, LakeSoul has implemented Flink CDC Sink, which can support Table API and SQL (single table), and Stream API (full database with multiple tables). The currently supported upstream data source is MySQL (5.6-8.0)"><meta data-rh="true" property="og:description" content="Since version 2.1.0, LakeSoul has implemented Flink CDC Sink, which can support Table API and SQL (single table), and Stream API (full database with multiple tables). The currently supported upstream data source is MySQL (5.6-8.0)"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://lakesoul-io.github.io/docs/Usage Docs/flink-cdc-sync"><link data-rh="true" rel="alternate" href="https://lakesoul-io.github.io/docs/Usage Docs/flink-cdc-sync" hreflang="en"><link data-rh="true" rel="alternate" href="https://lakesoul-io.github.io/zh-Hans/docs/Usage Docs/flink-cdc-sync" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://lakesoul-io.github.io/docs/Usage Docs/flink-cdc-sync" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="LakeSoul - An Opensource Cloud Native Realtime Lakehouse Framework RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="LakeSoul - An Opensource Cloud Native Realtime Lakehouse Framework Atom Feed"><link rel="stylesheet" href="/assets/css/styles.e6692cee.css">
<link rel="preload" href="/assets/js/runtime~main.9c98ae3d.js" as="script">
<link rel="preload" href="/assets/js/main.42e3ef4b.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="LakeSoul Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.svg" alt="LakeSoul Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">LakeSoul</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/intro">Docs</a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>English</a><ul class="dropdown__menu"><li><a href="/docs/Usage Docs/flink-cdc-sync" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="en">English</a></li><li><a href="/zh-Hans/docs/Usage Docs/flink-cdc-sync" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="zh-Hans">简体中文</a></li></ul></div><a href="https://github.com/lakesoul-io/LakeSoul" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro">LakeSoul Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/Getting Started/setup-local-env">Getting Started</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/Tutorials/consume-cdc-via-spark-streaming">Tutorials</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/docs/Usage Docs/setup-meta-env">Usage Docs</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Usage Docs/setup-meta-env">Setup LakeSoul Meta DB</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Usage Docs/setup-spark">Setup Your Spark and Flink Project/Job</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Usage Docs/api-docs">Spark API Docs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Usage Docs/cdc-ingestion-table">Use LakeSoul CDC Table Format</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/Usage Docs/flink-cdc-sync">LakeSoul Flink CDC Synchronization of Entire MySQL Database</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Usage Docs/flink-lakesoul-connector">LakeSoul Flink Connector</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Usage Docs/auto-compaction-task">LakeSoul Global Automatic Compaction Service Usage</a></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Usage Docs</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">LakeSoul Flink CDC Synchronization of Entire MySQL Database</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>LakeSoul Flink CDC Synchronization of Entire MySQL Database</h1><p>Since version 2.1.0, LakeSoul has implemented Flink CDC Sink, which can support Table API and SQL (single table), and Stream API (full database with multiple tables). The currently supported upstream data source is MySQL (5.6-8.0)</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="main-features">Main features<a href="#main-features" class="hash-link" aria-label="Direct link to Main features" title="Direct link to Main features">​</a></h2><p>In the Stream API, the main functions of LakeSoul Sink are:</p><ul><li>Support real-time CDC synchronization of thousands of tables (different schemas) in the same Flink job, and different tables will be automatically written to the corresponding table names of LakeSoul</li><li>Support automatic synchronization of schema changes (DDL) to LakeSoul, and automatic compatibility of downstream reads (currently supports adding and deleting columns);</li><li>Support automatic perception of new tables in the upstream database during operation, and automatic table creation in LakeSoul;</li><li>Support Exactly Once semantics, even if a Flink job fails, it can ensure that the data is not lost or heavy;</li><li>Provide Flink command line startup entry class, support specifying parameters such as database name, table name blacklist, parallelism, etc.;</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="how-to-use-the-command-line">How to use the command line<a href="#how-to-use-the-command-line" class="hash-link" aria-label="Direct link to How to use the command line" title="Direct link to How to use the command line">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-download-lakesoul-flink-jar">1. Download LakeSoul Flink Jar<a href="#1-download-lakesoul-flink-jar" class="hash-link" aria-label="Direct link to 1. Download LakeSoul Flink Jar" title="Direct link to 1. Download LakeSoul Flink Jar">​</a></h3><p>It can be downloaded from the LakeSoul Release page: <a href="https://github.com/lakesoul-io/LakeSoul/releases/download/v2.2.0/lakesoul-flink-2.2.0-flink-1.14.jar" target="_blank" rel="noopener noreferrer">https://github.com/lakesoul-io/LakeSoul/releases/download/v2.2.0/lakesoul-flink-2.2.0-flink-1.14.jar</a>.</p><p>The currently supported Flink version is 1.14.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-start-the-flink-job">2. Start the Flink job<a href="#2-start-the-flink-job" class="hash-link" aria-label="Direct link to 2. Start the Flink job" title="Direct link to 2. Start the Flink job">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="21-add-lakesoul-metadata-database-configuration">2.1 Add LakeSoul metadata database configuration<a href="#21-add-lakesoul-metadata-database-configuration" class="hash-link" aria-label="Direct link to 2.1 Add LakeSoul metadata database configuration" title="Direct link to 2.1 Add LakeSoul metadata database configuration">​</a></h4><p>Add the following configuration to <code>$FLINK_HOME/conf/flink-conf.yaml</code>:</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">containerized.master.env.LAKESOUL_PG_DRIVER</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> com.lakesoul.shaded.org.postgresql.Driver</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">containerized.master.env.LAKESOUL_PG_USERNAME</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> root</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">containerized.master.env.LAKESOUL_PG_PASSWORD</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> root</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">containerized.master.env.LAKESOUL_PG_URL</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> jdbc</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">postgresql</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//localhost</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">5432/test_lakesoul_meta</span><span class="token punctuation" style="color:#393A34">?</span><span class="token plain">stringtype=unspecified</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">containerized.taskmanager.env.LAKESOUL_PG_DRIVER</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> com.lakesoul.shaded.org.postgresql.Driver</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">containerized.taskmanager.env.LAKESOUL_PG_USERNAME</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> root</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">containerized.taskmanager.env.LAKESOUL_PG_PASSWORD</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> root</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">containerized.taskmanager.env.LAKESOUL_PG_URL</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> jdbc</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">postgresql</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//localhost</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">5432/test_lakesoul_meta</span><span class="token punctuation" style="color:#393A34">?</span><span class="token plain">stringtype=unspecified</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Note that both the master and taskmanager environment variables need to be set.</p><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_S0QG"><p>The connection information, username and password of the Postgres database need to be modified according to the actual deployment.</p></div></div><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</div><div class="admonitionContent_S0QG"><p>Note that if you use Session mode to start a job, that is, submit the job to Flink Standalone Cluster as a client, <code>flink run</code> as a client will not read the above configuration, so you need to configure the environment variables separately, namely:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">LAKESOUL_PG_DRIVER</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">com.lakesoul.shaded.org.postgresql.Driver</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">LAKESOUL_PG_URL</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">jdbc:postgresql://localhost:5432/test_lakesoul_meta?stringtype</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">unspecified</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">LAKESOUL_PG_USERNAME</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">root</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">LAKESOUL_PG_PASSWORD</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">root</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="22-start-sync-job">2.2 Start sync job<a href="#22-start-sync-job" class="hash-link" aria-label="Direct link to 2.2 Start sync job" title="Direct link to 2.2 Start sync job">​</a></h4><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">bin/flink run -c org.apache.flink.lakesoul.entry.MysqlCdc </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    lakesoul-flink-2.2.0-flink-1.14.jar </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --source_db.host localhost </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --source_db.port </span><span class="token number" style="color:#36acaa">3306</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --source_db.db_name default </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --source_db.user root </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --source_db.password root </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --source.parallelism </span><span class="token number" style="color:#36acaa">4</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --sink.parallelism </span><span class="token number" style="color:#36acaa">4</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --server_time_zone</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">Asia/Shanghai</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --warehouse_path s3://bucket/lakesoul/flink/data </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --flink.checkpoint s3://bucket/lakesoul/flink/checkpoints </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --flink.savepoint s3://bucket/lakesoul/flink/savepoints</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Description of required parameters:</p><table><thead><tr><th>Parameter</th><th>Meaning</th><th>Value Description</th></tr></thead><tbody><tr><td>-c</td><td>The task runs the main function entry class</td><td>org.apache.flink.lakesoul.entry.MysqlCdc</td></tr><tr><td>Main package</td><td>Task running jar</td><td>lakesoul-flink-2.2.0-flink-1.14.jar</td></tr><tr><td>--source_db.host</td><td>The address of the MySQL database</td><td></td></tr><tr><td>--source_db.port</td><td>MySQL database port</td><td></td></tr><tr><td>--source_db.user</td><td>MySQL database username</td><td></td></tr><tr><td>--source_db.password</td><td>Password for MySQL database</td><td></td></tr><tr><td>--source.parallelism</td><td>The parallelism of a single table read task affects the data reading speed. The larger the value, the greater the pressure on MySQL</td><td>The parallelism can be adjusted according to the write QPS of MySQL</td></tr><tr><td>--sink.parallelism</td><td>The parallelism of the single-table write task, which is also the number of primary key shards in the LakeSoul table. Affects the landing speed of data entering the lake. The larger the value, the greater the number of small files, which affects the subsequent read performance; the smaller the value, the greater the pressure on the write task, and the greater the possibility of data skew. It can be adjusted according to the data volume of the largest table. It is generally recommended that a degree of parallelism (primary key sharding) manage no more than 10 million rows of data.</td><td></td></tr><tr><td>--warehouse_path</td><td>Data storage path prefix (cluster prefix is ​​required for hdfs)</td><td>LakeSoul will write the corresponding table data to the ${warehouse_path}/database_name/table_name/ directory</td></tr><tr><td>--flink.savepoint</td><td>Flink savepoint path (cluster prefix is ​​required for hdfs)</td><td></td></tr><tr><td>--flink.checkpoint</td><td>Flink checkpoint path (cluster prefix is ​​required for hdfs)</td><td></td></tr></tbody></table><p>Other Flink parameters, such as job manager, task manager CPU, memory, slots, etc., also need to be set according to the specific situation.</p><p>Optional parameter description:</p><table><thead><tr><th>Parameter</th><th>Meaning Description</th><th>Parameter Filling Format</th></tr></thead><tbody><tr><td>--source_db.exclude_tables</td><td>A list of data table names that do not need to be synchronized, separated by commas, the default is empty</td><td>--source_db.exclude_tables test_1,test_2</td></tr><tr><td>--job.checkpoint_mode</td><td>Data synchronization mode, the default is EXACTLY_ONCE</td><td>--job.checkpoint_mode AT_LEAST_ONCE</td></tr><tr><td>--job.checkpoint_interval</td><td>Checkpoint storage interval, in ms, default is 10 minutes</td><td>--job.checkpoint_interval 1200000</td></tr><tr><td>--server_time_zone=Asia/Shanghai</td><td>MySQL server time zone, Flink side defaults to &quot;Asia/Shanghai&quot;</td><td>Refer to <!-- -->[JDK ZoneID documentation]<!-- -->(<a href="https://docs.oracle.com/javase/8/docs/api/java" target="_blank" rel="noopener noreferrer">https://docs.oracle.com/javase/8/docs/api/java</a> /time/ZoneId.html)</td></tr></tbody></table><h2 class="anchor anchorWithStickyNavbar_LWe7" id="lakesoul-flink-cdc-sink-job-execution-process">LakeSoul Flink CDC Sink job execution process<a href="#lakesoul-flink-cdc-sink-job-execution-process" class="hash-link" aria-label="Direct link to LakeSoul Flink CDC Sink job execution process" title="Direct link to LakeSoul Flink CDC Sink job execution process">​</a></h2><p>In the initialization phase after the LakeSoul Flink job starts, it will first read all the tables in the configured MySQL DB (excluding tables that do not need to be synchronized). For each table, first determine whether it exists in LakeSoul. If it does not exist, a LakeSoul table is automatically created, and its schema is consistent with the corresponding table in MySQL.</p><p>After initialization, the CDC Stream of all tables will be read and written to the corresponding LakeSoul tables in Upsert mode.</p><p>If a DDL Schema change occurs to a MySQL table during synchronization, the change will also be applied to the corresponding LakeSoul table.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="lakesoul-flink-cdc-sink-exactly-once-semantic-guarantee">LakeSoul Flink CDC Sink Exactly Once Semantic Guarantee<a href="#lakesoul-flink-cdc-sink-exactly-once-semantic-guarantee" class="hash-link" aria-label="Direct link to LakeSoul Flink CDC Sink Exactly Once Semantic Guarantee" title="Direct link to LakeSoul Flink CDC Sink Exactly Once Semantic Guarantee">​</a></h2><p>LakeSoul Flink CDC Sink automatically saves the relevant state during job running, and can restore and rewrite the state when a Flink job fails, so data will not be lost.</p><p>When LakeSoul writes, write idempotency is guaranteed in two parts:</p><ol><li>When the stage file is Commit, it is consistent with the Flink File Sink. The atomicity of the file system rename operation is used to ensure that the staging file is written to the final path. Because rename is atomic, no duplicate writes or misses occur after a Failover.</li><li>When the LakeSoul metadata is submitted, the file path will be recorded first, and when the snapshot is updated, the file will be marked as submitted through a transaction. After Failover, by judging whether a file has been submitted, the idempotency of submission can be guaranteed.</li></ol><p>In summary, LakeSoul Flink CDC Sink ensures that data is not lost through state recovery, and ensures that data is not duplicated by committing with idempotency, which achieves an exactly once semantic guarantee.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="type-mapping-relationship-between-mysql-and-lakesoul">Type mapping relationship between MySQL and LakeSoul<a href="#type-mapping-relationship-between-mysql-and-lakesoul" class="hash-link" aria-label="Direct link to Type mapping relationship between MySQL and LakeSoul" title="Direct link to Type mapping relationship between MySQL and LakeSoul">​</a></h2><p>Since MySQL, Spark, Parquet and other data types are not exactly the same, LakeSoul makes the following mapping relationships during synchronization (types that are not in the table are currently not supported):</p><table><thead><tr><th>MySQL Type</th><th>Spark Type</th></tr></thead><tbody><tr><td>BOOLEAN, BOOL</td><td>org.apache.spark.sql.types.DataTypes.BooleanType</td></tr><tr><td>BIT(1)</td><td>org.apache.spark.sql.types.DataTypes.BooleanType</td></tr><tr><td>BIT(&gt;1)</td><td>org.apache.spark.sql.types.DataTypes.BinaryType</td></tr><tr><td>TINYINT</td><td>org.apache.spark.sql.types.DataTypes.IntegerType</td></tr><tr><td>SMALLINT<!-- -->[(M)]</td><td>org.apache.spark.sql.types.DataTypes.IntegerType</td></tr><tr><td>MEDIUMINT<!-- -->[(M)]</td><td>org.apache.spark.sql.types.DataTypes.IntegerType</td></tr><tr><td>INT, INTEGER<!-- -->[(M)]</td><td>org.apache.spark.sql.types.DataTypes.IntegerType</td></tr><tr><td>BIGINT<!-- -->[(M)]</td><td>org.apache.spark.sql.types.DataTypes.LongType</td></tr><tr><td>REAL<!-- -->[(M,D)]</td><td>org.apache.spark.sql.types.DataTypes.FloatType</td></tr><tr><td>FLOAT<!-- -->[(M,D)]</td><td>org.apache.spark.sql.types.DataTypes.DoubleType</td></tr><tr><td>DOUBLE<!-- -->[(M,D)]</td><td>org.apache.spark.sql.types.DataTypes.DoubleType</td></tr><tr><td>CHAR(M)]</td><td>org.apache.spark.sql.types.DataTypes.StringType</td></tr><tr><td>VARCHAR(M)]</td><td>org.apache.spark.sql.types.DataTypes.StringType</td></tr><tr><td>BINARY(M)]</td><td>org.apache.spark.sql.types.DataTypes.BinaryType</td></tr><tr><td>VARBINARY(M)]</td><td>org.apache.spark.sql.types.DataTypes.BinaryType</td></tr><tr><td>TINYBLOB</td><td>org.apache.spark.sql.types.DataTypes.BinaryType</td></tr><tr><td>TINYTEXT</td><td>org.apache.spark.sql.types.DataTypes.StringType</td></tr><tr><td>BLOB</td><td>org.apache.spark.sql.types.DataTypes.BinaryType</td></tr><tr><td>TEXT</td><td>org.apache.spark.sql.types.DataTypes.StringType</td></tr><tr><td>MEDIUMBLOB</td><td>org.apache.spark.sql.types.DataTypes.BinaryType</td></tr><tr><td>MEDIUMTEXT</td><td>org.apache.spark.sql.types.DataTypes.StringType</td></tr><tr><td>LONGBLOB</td><td>org.apache.spark.sql.types.DataTypes.BinaryType</td></tr><tr><td>LONGTEXT</td><td>org.apache.spark.sql.types.DataTypes.StringType</td></tr><tr><td>JSON</td><td>org.apache.spark.sql.types.DataTypes.StringType</td></tr><tr><td>ENUM</td><td>org.apache.spark.sql.types.DataTypes.StringType</td></tr><tr><td>SET</td><td>org.apache.spark.sql.types.DataTypes.StringType</td></tr><tr><td>YEAR<!-- -->[(2<!-- -->|<!-- -->4)]</td><td>org.apache.spark.sql.types.DataTypes.IntegerType</td></tr><tr><td>TIMESTAMP<!-- -->[(M)]</td><td>org.apache.spark.sql.types.DataTypes.TimestampType</td></tr><tr><td>DATE</td><td>org.apache.spark.sql.types.DataTypes.DateType</td></tr><tr><td>TIME<!-- -->[(M)]</td><td>org.apache.spark.sql.types.DataTypes.LongType</td></tr><tr><td>DATETIME<!-- -->[(M)]</td><td>org.apache.spark.sql.types.DataTypes.TimestampType</td></tr><tr><td>NUMERIC[(M<!-- -->[,D]<!-- -->)],DECIMAL[(M<!-- -->[,D]<!-- -->)]</td><td><em>if decimal.handling.mode=precise</em> <br> <!-- -->org.apache.spark.sql.types.DecimalType(M,D) <br>if <em>decimal.handling.mode=string</em><br>   <!-- --> <!-- -->                 org.apache.spark.sql.types.DataTypes.StringType<br><em>if decimal.handling.mode=doulbe</em> <br> <!-- -->org.apache.spark.sql.types.DataTypes.DoubleType</td></tr><tr><td>GEOMETRY, LINESTRING, POLYGON, MULTIPOINT, MULTILINESTRING, MULTIPOLYGON, GEOMETRYCOLLECTION, POINT</td><td>Not currently supported</td></tr></tbody></table><p>Types in Spark, type names in Spark SQL, you can find the corresponding relationship in the <a href="https://spark.apache.org/docs/latest/sql-ref-datatypes.html" target="_blank" rel="noopener noreferrer">Spark Data Types</a> document.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="precautions">Precautions<a href="#precautions" class="hash-link" aria-label="Direct link to Precautions" title="Direct link to Precautions">​</a></h2><ol><li>A table in MySQL must have a primary key, and tables without a primary key are currently not supported;</li><li>The DDL change currently supports adding a column at the end, or deleting a column in the middle; the default value of a new column currently only supports <code>null</code>, and LakeSoul will automatically add a <code>null</code> value to the column when reading old data; the deleted column , LakeSoul will automatically filter this column when reading;</li><li>The TIME type in MySQL corresponds to the LongType type in LakeSoul, as there is no TIME data type in Spark and Debezium resolves the TIME type to the current value in milliseconds from 00:00:00. Therefore, this is consistent with Debezium;</li><li>The TIMESTAMP and DATETIME types in MySQL are stored as UTC TIME ZOME values in LakeSoul to avoid time zone resolution issues; When reading, you just need to specify the time zone and it can be parsed according to the specified time zone. So it is necessary to correctly fill in the server_time_zone parameter when starting the FLINK CDC task.</li></ol></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/lakesoul-io/LakeSoul/tree/main/website/docs/03-Usage Docs/05-flink-cdc-sync.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/Usage Docs/cdc-ingestion-table"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Use LakeSoul CDC Table Format</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/Usage Docs/flink-lakesoul-connector"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">LakeSoul Flink Connector</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#main-features" class="table-of-contents__link toc-highlight">Main features</a></li><li><a href="#how-to-use-the-command-line" class="table-of-contents__link toc-highlight">How to use the command line</a><ul><li><a href="#1-download-lakesoul-flink-jar" class="table-of-contents__link toc-highlight">1. Download LakeSoul Flink Jar</a></li><li><a href="#2-start-the-flink-job" class="table-of-contents__link toc-highlight">2. Start the Flink job</a></li></ul></li><li><a href="#lakesoul-flink-cdc-sink-job-execution-process" class="table-of-contents__link toc-highlight">LakeSoul Flink CDC Sink job execution process</a></li><li><a href="#lakesoul-flink-cdc-sink-exactly-once-semantic-guarantee" class="table-of-contents__link toc-highlight">LakeSoul Flink CDC Sink Exactly Once Semantic Guarantee</a></li><li><a href="#type-mapping-relationship-between-mysql-and-lakesoul" class="table-of-contents__link toc-highlight">Type mapping relationship between MySQL and LakeSoul</a></li><li><a href="#precautions" class="table-of-contents__link toc-highlight">Precautions</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/Getting Started/setup-local-env">Getting Started</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/Usage Docs/setup-meta-env">Docs</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/Tutorials/consume-cdc-via-spark-streaming">Tutorials</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://discord.gg/WJrHKq4BPf" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/lakesoul" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://lists.lfaidata.foundation/g/lakesoul-announce" target="_blank" rel="noopener noreferrer" class="footer__link-item">LakeSoul Announce<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://lists.lfaidata.foundation/g/lakesoul-technical-discuss" target="_blank" rel="noopener noreferrer" class="footer__link-item">LakeSoul Technical-Discuss<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://lists.lfaidata.foundation/g/lakesoul-tsc" target="_blank" rel="noopener noreferrer" class="footer__link-item">LakeSoul TSC<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/lakesoul-io/lakesoul" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright"><div class="customCopyright">Copyright ©  2023  LakeSoul The Linux Foundation®. All rights reserved. The Linux Foundation has registered trademarks and uses trademarks. <br> For a list of trademarks of The Linux Foundation, please see our <a href="https://www.linuxfoundation.org/legal/trademark-usage" target="_blank">Trademark Usage</a> page. Linux is a registered trademark of Linus Torvalds. <a href="https://www.linuxfoundation.org/legal/privacy-policy" target="_blank">Privacy Policy</a> and <a href="https://www.linuxfoundation.org/legal/terms" target="_blank">Terms of Use</a></div></div></div></div></footer></div>
<script src="/assets/js/runtime~main.9c98ae3d.js"></script>
<script src="/assets/js/main.42e3ef4b.js"></script>
</body>
</html>